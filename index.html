<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FOREXRISK PRO ‚Ä¢ DEBUG VERSION</title>

    <!-- React y ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            color: #fff;
            font-family: 'Rajdhani', sans-serif;
            padding: 2rem;
        }

        .debug-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            font-family: 'Orbitron', sans-serif;
            color: #ff0040;
            margin-bottom: 2rem;
            font-size: 2rem;
        }

        .debug-box {
            background: #0a0a0a;
            border: 1px solid #333;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-radius: 8px;
        }

        .debug-title {
            color: #00ff00;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }

        pre {
            background: #000;
            padding: 1rem;
            overflow-x: auto;
            border-left: 3px solid #ff0040;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .status {
            display: inline-block;
            padding: 0.5rem 1rem;
            background: #ff0040;
            color: #000;
            font-weight: 900;
            margin-bottom: 1rem;
        }

        .status.success {
            background: #00ff00;
        }

        .btn {
            background: transparent;
            border: 2px solid #ff0040;
            color: #ff0040;
            padding: 0.75rem 1.5rem;
            font-family: 'Orbitron', sans-serif;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #ff0040;
            color: #000;
        }

        .pair-card {
            background: #0a0a0a;
            border: 1px solid #ff0040;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .pair-card h3 {
            color: #ff0040;
            font-family: 'Orbitron', sans-serif;
            margin-bottom: 0.5rem;
        }

        .price {
            font-size: 2rem;
            font-family: 'Orbitron', sans-serif;
            color: #00ff00;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        const API_KEY = '04eec7507ab745e18e787977413c2649';

        const App = () => {
            const [debugInfo, setDebugInfo] = useState([]);
            const [pairs, setPairs] = useState([]);
            const [loading, setLoading] = useState(false);

            const addDebug = (title, data) => {
                setDebugInfo(prev => [...prev, { title, data, time: new Date().toLocaleTimeString() }]);
            };

            const testAPI = async () => {
                setLoading(true);
                setDebugInfo([]);
                setPairs([]);

                addDebug('üîç INICIANDO TEST', 'Probando conexi√≥n con Twelve Data API...');

                // Test 1: Un solo s√≠mbolo
                try {
                    addDebug('üì° TEST 1', 'Probando con un solo s√≠mbolo: EUR/USD');
                    const url1 = `https://api.twelvedata.com/quote?symbol=EUR/USD&apikey=${API_KEY}`;
                    addDebug('üåê URL', url1.replace(API_KEY, 'YOUR_API_KEY'));

                    const response1 = await fetch(url1);
                    const data1 = await response1.json();

                    addDebug('üì• RESPUESTA EUR/USD', data1);

                    if (data1.code && data1.code !== 200) {
                        addDebug('‚ùå ERROR', `C√≥digo ${data1.code}: ${data1.message}`);
                    }
                } catch (error) {
                    addDebug('‚ùå ERROR FETCH', error.message);
                }

                // Test 2: M√∫ltiples s√≠mbolos
                try {
                    addDebug('üì° TEST 2', 'Probando con m√∫ltiples s√≠mbolos');
                    const symbols = 'EUR/USD,GBP/USD,USD/JPY';
                    const url2 = `https://api.twelvedata.com/quote?symbol=${symbols}&apikey=${API_KEY}`;
                    addDebug('üåê URL', url2.replace(API_KEY, 'YOUR_API_KEY'));

                    const response2 = await fetch(url2);
                    const data2 = await response2.json();

                    addDebug('üì• RESPUESTA M√öLTIPLE', data2);

                    // Procesar respuesta
                    const processedPairs = [];

                    if (Array.isArray(data2)) {
                        addDebug('‚úÖ FORMATO', 'Respuesta es un ARRAY');
                        data2.forEach(item => {
                            if (item.symbol && item.close) {
                                processedPairs.push({
                                    symbol: item.symbol,
                                    price: parseFloat(item.close),
                                    open: parseFloat(item.open || item.close),
                                    high: parseFloat(item.high || item.close),
                                    low: parseFloat(item.low || item.close),
                                });
                            }
                        });
                    } else if (data2.symbol) {
                        addDebug('‚úÖ FORMATO', 'Respuesta es un OBJETO');
                        processedPairs.push({
                            symbol: data2.symbol,
                            price: parseFloat(data2.close),
                            open: parseFloat(data2.open || data2.close),
                            high: parseFloat(data2.high || data2.close),
                            low: parseFloat(data2.low || data2.close),
                        });
                    } else {
                        addDebug('‚ùå FORMATO DESCONOCIDO', 'No se pudo procesar la respuesta');
                    }

                    if (processedPairs.length > 0) {
                        addDebug('‚úÖ PROCESADOS', `${processedPairs.length} pares con datos v√°lidos`);
                        setPairs(processedPairs);
                    }

                } catch (error) {
                    addDebug('‚ùå ERROR FETCH 2', error.message);
                }

                // Test 3: Price endpoint
                try {
                    addDebug('üì° TEST 3', 'Probando endpoint /price');
                    const url3 = `https://api.twelvedata.com/price?symbol=EUR/USD&apikey=${API_KEY}`;
                    addDebug('üåê URL', url3.replace(API_KEY, 'YOUR_API_KEY'));

                    const response3 = await fetch(url3);
                    const data3 = await response3.json();

                    addDebug('üì• RESPUESTA /price', data3);
                } catch (error) {
                    addDebug('‚ùå ERROR FETCH 3', error.message);
                }

                // Test 4: Verificar l√≠mite de API
                try {
                    addDebug('üì° TEST 4', 'Verificando estado del API key');
                    const url4 = `https://api.twelvedata.com/forex_pairs?apikey=${API_KEY}`;

                    const response4 = await fetch(url4);
                    const data4 = await response4.json();

                    if (data4.code) {
                        addDebug('‚ö†Ô∏è L√çMITE API', `C√≥digo ${data4.code}: ${data4.message}`);
                    } else if (Array.isArray(data4) && data4.length > 0) {
                        addDebug('‚úÖ API KEY V√ÅLIDA', `${data4.length} pares forex disponibles`);
                        addDebug('üìã PRIMEROS 5 PARES', data4.slice(0, 5));
                    }
                } catch (error) {
                    addDebug('‚ùå ERROR FETCH 4', error.message);
                }

                setLoading(false);
            };

            return (
                <div className="debug-container">
                    <h1>üîß FOREXRISK PRO ‚Ä¢ DEBUG MODE</h1>

                    <div className="debug-box">
                        <div className="debug-title">CONTROL PANEL</div>
                        <button onClick={testAPI} disabled={loading} className="btn">
                            {loading ? '‚è≥ PROBANDO...' : '‚ñ∂Ô∏è EJECUTAR TEST'}
                        </button>
                        <p style={{marginTop: '1rem', color: '#808080'}}>
                            Este test verificar√° la conexi√≥n con la API de Twelve Data y mostrar√° exactamente qu√© datos devuelve.
                        </p>
                    </div>

                    {pairs.length > 0 && (
                        <div className="debug-box">
                            <div className="debug-title">‚úÖ PARES PROCESADOS CORRECTAMENTE</div>
                            {pairs.map(pair => (
                                <div key={pair.symbol} className="pair-card">
                                    <h3>{pair.symbol}</h3>
                                    <div className="price">{pair.price.toFixed(4)}</div>
                                    <div style={{marginTop: '0.5rem', fontSize: '0.9rem', color: '#808080'}}>
                                        Open: {pair.open.toFixed(4)} | High: {pair.high.toFixed(4)} | Low: {pair.low.toFixed(4)}
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}

                    {debugInfo.map((info, index) => (
                        <div key={index} className="debug-box">
                            <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem'}}>
                                <div className="debug-title">{info.title}</div>
                                <span style={{color: '#808080', fontSize: '0.8rem'}}>{info.time}</span>
                            </div>
                            <pre>{typeof info.data === 'object' ? JSON.stringify(info.data, null, 2) : info.data}</pre>
                        </div>
                    ))}

                    {debugInfo.length === 0 && !loading && (
                        <div className="debug-box">
                            <p style={{color: '#808080', textAlign: 'center', padding: '2rem'}}>
                                Presiona el bot√≥n para ejecutar el diagn√≥stico
                            </p>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>