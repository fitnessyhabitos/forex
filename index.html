<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FOREX DATA PRO</title>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@0.2.1/dist/chartjs-chart-financial.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;600;700&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --neon-red: #ff0040; --neon-green: #00ff00; --neon-cyan: #00ffff; --neon-yellow: #ffff00;
            --dark-bg: #000000; --dark-surface: #0a0a0a; --dark-elevated: #121212; --border-dark: #1a1a1a;
            --text-white: #ffffff; --text-gray: #808080;
        }
        body { background: var(--dark-bg); color: var(--text-white); font-family: 'Rajdhani', sans-serif; overflow-x: hidden; }
        body::before { content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: repeating-linear-gradient(0deg, rgba(255, 0, 64, 0.03), rgba(255, 0, 64, 0.03) 1px, transparent 1px, transparent 2px); pointer-events: none; z-index: 1000; animation: scan 8s linear infinite; }
        @keyframes scan { 0% { transform: translateY(0); } 100% { transform: translateY(10px); } }
        h1, h2, h3, h4 { font-family: 'Orbitron', sans-serif; text-transform: uppercase; letter-spacing: 2px; }
        .card { background: var(--dark-surface); border: 1px solid var(--border-dark); padding: 1.5rem; position: relative; transition: all 0.3s; clip-path: polygon(0 0, calc(100% - 15px) 0, 100% 15px, 100% 100%, 0 100%); }
        .card::before { content: ''; position: absolute; top: 0; right: 0; width: 15px; height: 15px; background: var(--neon-red); clip-path: polygon(100% 0, 100% 100%, 0 0); }
        .card:hover { border-color: var(--neon-red); box-shadow: 0 0 20px rgba(255, 0, 64, 0.3); }
        .best-opportunity { border: 3px solid var(--neon-red); box-shadow: 0 0 30px rgba(255, 0, 64, 0.8); animation: neonPulse 2s infinite; margin-top: 2.5rem; }
        .best-opportunity::after { content: '‚ö° MEJOR OPORTUNIDAD'; position: absolute; top: -1.75rem; left: 50%; transform: translateX(-50%); background: var(--neon-red); color: var(--dark-bg); padding: 0.5rem 1.5rem; font-family: 'Orbitron', sans-serif; font-weight: 900; font-size: 0.8rem; letter-spacing: 2px; white-space: nowrap; z-index: 10; }
        @keyframes neonPulse { 0%, 100% { box-shadow: 0 0 20px rgba(255, 0, 64, 0.8); } 50% { box-shadow: 0 0 40px rgba(255, 0, 64, 1); } }
        .btn { font-family: 'Orbitron', sans-serif; font-weight: 700; padding: 0.75rem 1.5rem; border: 2px solid var(--neon-red); background: transparent; color: var(--neon-red); text-transform: uppercase; letter-spacing: 2px; cursor: pointer; transition: all 0.3s; clip-path: polygon(10px 0, 100% 0, calc(100% - 10px) 100%, 0 100%); }
        .btn:hover { background: var(--neon-red); color: var(--dark-bg); box-shadow: 0 0 20px rgba(255, 0, 64, 0.8); }
        .btn-primary { background: var(--neon-red); color: var(--dark-bg); }
        .btn-small { padding: 0.5rem 1rem; font-size: 0.75rem; }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.95); backdrop-filter: blur(5px); z-index: 999; overflow-y: auto; }
        .neon-text { color: var(--neon-red); text-shadow: 0 0 10px rgba(255, 0, 64, 0.8); }
        .signal-badge { padding: 0.5rem 1rem; font-family: 'Orbitron', sans-serif; font-weight: 900; font-size: 0.875rem; letter-spacing: 1px; display: inline-block; animation: pulse 2s infinite; }
        .signal-buy { background: var(--neon-green); color: var(--dark-bg); box-shadow: 0 0 20px rgba(0, 255, 0, 0.8); }
        .signal-sell { background: var(--neon-red); color: var(--dark-bg); box-shadow: 0 0 20px rgba(255, 0, 64, 0.8); }
        .signal-neutral { background: var(--text-gray); color: var(--dark-bg); }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .chart-container { position: relative; height: 400px; margin: 1.5rem 0; background: var(--dark-elevated); padding: 1rem; border: 1px solid var(--border-dark); }
        .indicator-box { background: var(--dark-elevated); border-left: 3px solid; padding: 1rem; margin-bottom: 1rem; }
        .indicator-box.bullish { border-left-color: var(--neon-green); }
        .indicator-box.bearish { border-left-color: var(--neon-red); }
        .indicator-box.neutral { border-left-color: var(--text-gray); }
        .probability-bar { height: 30px; background: var(--dark-elevated); border: 1px solid var(--border-dark); position: relative; overflow: hidden; }
        .probability-fill { height: 100%; background: linear-gradient(90deg, var(--neon-green), var(--neon-cyan)); transition: width 0.5s; display: flex; align-items: center; justify-content: center; font-weight: 900; color: var(--dark-bg); }
        .ratio-card { background: var(--dark-elevated); border: 1px solid var(--border-dark); padding: 1rem; text-align: center; transition: all 0.3s; }
        .ratio-card:hover { border-color: var(--neon-cyan); transform: translateY(-5px); }
        .live-badge { background: var(--neon-green); color: var(--dark-bg); padding: 0.25rem 0.75rem; font-size: 0.7rem; font-weight: 900; letter-spacing: 1px; animation: pulse 2s infinite; }
        .price-change { font-family: 'Orbitron', sans-serif; font-weight: 900; animation: priceFlash 0.3s; }
        @keyframes priceFlash { 0% { transform: scale(1); } 50% { transform: scale(1.05); color: var(--neon-cyan); } 100% { transform: scale(1); } }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; animation: pulse 2s infinite; display: inline-block; }
        .status-dot.connected { background: var(--neon-green); box-shadow: 0 0 10px var(--neon-green); }
        .status-dot.disconnected { background: var(--neon-red); box-shadow: 0 0 10px var(--neon-red); }
        input, select { background: var(--dark-elevated); border: 1px solid var(--border-dark); color: var(--text-white); padding: 0.75rem; font-family: 'Rajdhani', sans-serif; font-size: 1rem; width: 100%; transition: all 0.3s; }
        input:focus, select:focus { outline: none; border-color: var(--neon-cyan); box-shadow: 0 0 10px rgba(0, 255, 255, 0.3); }
        label { display: block; margin-bottom: 0.5rem; font-weight: 600; font-size: 0.875rem; color: var(--text-gray); }
        .form-group { margin-bottom: 1.5rem; }
        .alarm-item { background: var(--dark-elevated); border: 1px solid var(--border-dark); padding: 1rem; margin-bottom: 0.5rem; display: flex; justify-content: space-between; align-items: center; transition: all 0.3s; }
        .alarm-item:hover { border-color: var(--neon-cyan); }
        .alarm-active { border-left: 3px solid var(--neon-green); }
        .alarm-triggered { background: rgba(255, 0, 64, 0.1); border-color: var(--neon-red); animation: neonPulse 1s infinite; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-top: 1rem; }
        .stat-box { background: var(--dark-elevated); border: 1px solid var(--border-dark); padding: 1rem; text-align: center; }
        .stat-value { font-family: 'Orbitron', sans-serif; font-size: 1.5rem; font-weight: 900; color: var(--neon-cyan); margin-bottom: 0.25rem; }
        .stat-label { font-size: 0.75rem; color: var(--text-gray); }
        @media (max-width: 768px) { .best-opportunity { margin-top: 3rem; } }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const TWELVE_DATA_API_KEY = '04eec7507ab745e18e787977413c2649';
        const TWELVE_DATA_BASE = 'https://api.twelvedata.com';
        const FINNHUB_API_KEY = 'd5n740hr01qh5ppc15r0d5n740hr01qh5ppc15rg';
        const FINNHUB_WS = 'wss://ws.finnhub.io';

        const PAIRS = [
            { symbol: 'EUR/USD', finnhubSymbol: 'OANDA:EUR_USD', displaySymbol: 'EURUSD', name: 'Euro / US Dollar', decimals: 5, pipValue: 10 },
            { symbol: 'GBP/USD', finnhubSymbol: 'OANDA:GBP_USD', displaySymbol: 'GBPUSD', name: 'British Pound / US Dollar', decimals: 5, pipValue: 10 },
            { symbol: 'USD/JPY', finnhubSymbol: 'OANDA:USD_JPY', displaySymbol: 'USDJPY', name: 'US Dollar / Japanese Yen', decimals: 3, pipValue: 9.09 },
            { symbol: 'EUR/JPY', finnhubSymbol: 'OANDA:EUR_JPY', displaySymbol: 'EURJPY', name: 'Euro / Japanese Yen', decimals: 3, pipValue: 9.09 },
            { symbol: 'XAU/USD', finnhubSymbol: 'OANDA:XAU_USD', displaySymbol: 'XAUUSD', name: 'Gold / US Dollar', decimals: 2, pipValue: 1 },
        ];

        const loadProfile = () => {
            const saved = localStorage.getItem('forexDataProProfile');
            return saved ? JSON.parse(saved) : { accountSize: 10000, currency: 'USD', leverage: 100, riskPerTrade: 2, lotSize: 0.1, minScore: 60 };
        };
        const saveProfile = (p) => localStorage.setItem('forexDataProProfile', JSON.stringify(p));
        const loadAlarms = () => { const saved = localStorage.getItem('forexDataProAlarms'); return saved ? JSON.parse(saved) : []; };
        const saveAlarms = (a) => localStorage.setItem('forexDataProAlarms', JSON.stringify(a));
        const calculatePotentialProfit = (lot, pips, pv) => lot * pips * pv;
        const calculateRequiredMargin = (lot, price, lev) => (lot * 100000 * price) / lev;

        const fetchDailyOpen = async (sym) => {
            try {
                const url = `${TWELVE_DATA_BASE}/time_series?symbol=${sym}&interval=1day&outputsize=1&apikey=${TWELVE_DATA_API_KEY}`;
                const res = await fetch(url);
                const data = await res.json();
                if (data.values && data.values.length > 0) {
                    return { open: parseFloat(data.values[0].open), high: parseFloat(data.values[0].high), low: parseFloat(data.values[0].low), close: parseFloat(data.values[0].close) };
                }
                return null;
            } catch (e) { return null; }
        };

        const calcRSI = (prices, period = 14) => {
            if (prices.length < period + 1) {
                if (prices.length < 2) return 50;
                const ch = prices[prices.length - 1] - prices[0];
                return ch > 0 ? 65 : ch < 0 ? 35 : 50;
            }
            let gains = 0, losses = 0;
            for (let i = prices.length - period; i < prices.length; i++) {
                const ch = prices[i] - prices[i - 1];
                if (ch > 0) gains += ch; else losses += Math.abs(ch);
            }
            const ag = gains / period, al = losses / period;
            if (al === 0) return 100;
            return 100 - (100 / (1 + ag / al));
        };

        const calcEMA = (prices, period) => {
            if (prices.length === 0) return 0;
            const k = 2 / (period + 1);
            let ema = prices[0];
            for (let i = 1; i < prices.length; i++) ema = prices[i] * k + ema * (1 - k);
            return ema;
        };

        const calcMACD = (prices) => {
            if (prices.length < 5) {
                if (prices.length < 2) return { macd: 0, signal: 0, histogram: 0 };
                const tr = prices[prices.length - 1] - prices[0];
                const macd = tr > 0 ? 0.0001 : -0.0001;
                return { macd, signal: 0, histogram: macd };
            }
            const e12 = calcEMA(prices, Math.min(12, prices.length));
            const e26 = calcEMA(prices, Math.min(26, prices.length));
            const macd = e12 - e26;
            return { macd, signal: macd * 0.9, histogram: macd - macd * 0.9 };
        };

        const calcBB = (prices, period = 20, sd = 2) => {
            if (prices.length < 3) {
                const p = prices[prices.length - 1] || 0;
                return { upper: p * 1.002, middle: p, lower: p * 0.998 };
            }
            const ap = Math.min(period, prices.length);
            const sl = prices.slice(-ap);
            const mid = sl.reduce((a, b) => a + b, 0) / ap;
            const var_ = sl.reduce((sum, p) => sum + Math.pow(p - mid, 2), 0) / ap;
            const std = Math.sqrt(var_);
            return { upper: mid + std * sd, middle: mid, lower: mid - std * sd };
        };

        const calcMA = (prices, period) => {
            if (prices.length < period) return prices[prices.length - 1] || 0;
            const sl = prices.slice(-period);
            return sl.reduce((a, b) => a + b, 0) / period;
        };

        const calcScore = (pair, hist) => {
            if (!pair.price || !pair.dailyOpen) return 0;
            const { price, dailyOpen, dailyHigh, dailyLow, volatility = 50 } = pair;
            let sc = 0;
            const dc = ((price - dailyOpen) / dailyOpen) * 100;
            const adc = Math.abs(dc);
            if (adc > 0.5) sc += 40; else if (adc > 0.3) sc += 30; else if (adc > 0.1) sc += 20; else sc += 10;
            const ch = Math.max(dailyHigh || price, price);
            const cl = Math.min(dailyLow || price, price);
            if (ch !== cl) {
                const rp = (price - cl) / (ch - cl);
                if (rp > 0.8 || rp < 0.2) sc += 30; else if (rp > 0.6 || rp < 0.4) sc += 20; else sc += 10;
            } else sc += 15;
            if (volatility > 40 && volatility < 100) sc += 20; else if (volatility > 20 && volatility < 150) sc += 15; else sc += 10;
            if (hist && hist.length >= 5) {
                const rp = hist.slice(-Math.min(10, hist.length));
                const m5 = calcMA(rp, Math.min(5, rp.length));
                const m10 = calcMA(rp, Math.min(10, rp.length));
                if ((price > m5 && m5 > m10) || (price < m5 && m5 < m10)) sc += 10; else sc += 5;
            } else sc += 5;
            return Math.min(100, Math.round(sc));
        };

        const analyzeSignals = (pair, hist) => {
            if (!hist || hist.length < 3) {
                return {
                    signal: 'NEUTRAL', confidence: 0,
                    reasons: ['Acumulando datos (' + (hist?.length || 0) + '/3 ticks)'],
                    entry: pair.price, stopLoss: pair.price * 0.995, takeProfit: pair.price * 1.01,
                    rsi: 50, macd: { macd: 0, signal: 0, histogram: 0 }, bb: { upper: 0, middle: 0, lower: 0 }
                };
            }

            const rsi = calcRSI(hist);
            const macd = calcMACD(hist);
            const bb = calcBB(hist);
            const cp = pair.price;
            const m5 = calcMA(hist, Math.min(5, hist.length));
            const m10 = calcMA(hist, Math.min(10, hist.length));

            let sig = 'NEUTRAL', conf = 0;
            const reas = [];

            if (rsi < 30) { conf += 30; reas.push('RSI sobreventa (' + rsi.toFixed(1) + ')'); sig = 'BUY'; }
            else if (rsi > 70) { conf += 30; reas.push('RSI sobrecompra (' + rsi.toFixed(1) + ')'); sig = 'SELL'; }
            else if (rsi < 40) { conf += 15; reas.push('RSI tendencia compra'); if (sig === 'NEUTRAL') sig = 'BUY'; }
            else if (rsi > 60) { conf += 15; reas.push('RSI tendencia venta'); if (sig === 'NEUTRAL') sig = 'SELL'; }

            if (macd.histogram > 0 && macd.macd > macd.signal) {
                conf += 25; reas.push('MACD cruce alcista'); if (sig === 'NEUTRAL') sig = 'BUY';
            } else if (macd.histogram < 0 && macd.macd < macd.signal) {
                conf += 25; reas.push('MACD cruce bajista'); if (sig === 'NEUTRAL') sig = 'SELL';
            }

            if (cp < bb.lower) { conf += 20; reas.push('Precio bajo Bollinger'); if (sig === 'NEUTRAL') sig = 'BUY'; }
            else if (cp > bb.upper) { conf += 20; reas.push('Precio sobre Bollinger'); if (sig === 'NEUTRAL') sig = 'SELL'; }

            if (hist.length >= 5) {
                if (m5 > m10 && cp > m5) { conf += 15; reas.push('Tendencia alcista (MA)'); if (sig === 'NEUTRAL') sig = 'BUY'; }
                else if (m5 < m10 && cp < m5) { conf += 15; reas.push('Tendencia bajista (MA)'); if (sig === 'NEUTRAL') sig = 'SELL'; }
            }

            const vol = pair.volatility || 50;
            if (vol > 30 && vol < 100) { conf += 10; reas.push('Volatilidad √≥ptima'); }

            if (pair.dailyOpen) {
                const dc = ((cp - pair.dailyOpen) / pair.dailyOpen) * 100;
                if (Math.abs(dc) > 0.3) {
                    conf += 10;
                    if (dc > 0) { reas.push('Momentum alcista del d√≠a'); if (sig === 'NEUTRAL') sig = 'BUY'; }
                    else { reas.push('Momentum bajista del d√≠a'); if (sig === 'NEUTRAL') sig = 'SELL'; }
                }
            }

            if (sig === 'NEUTRAL' && hist.length >= 3) {
                const fp = hist[0];
                const lp = hist[hist.length - 1];
                const tr = ((lp - fp) / fp) * 100;
                if (Math.abs(tr) > 0.01) {
                    conf = 35;
                    if (tr > 0) { sig = 'BUY'; reas.push('Tendencia micro alcista'); }
                    else { sig = 'SELL'; reas.push('Tendencia micro bajista'); }
                }
            }

            const atr = ((bb.upper - bb.lower) / 2) || (cp * 0.002);
            let entry = cp, sl, tp;
            if (sig === 'BUY') { sl = cp - atr * 1.5; tp = cp + atr * 3; }
            else if (sig === 'SELL') { sl = cp + atr * 1.5; tp = cp - atr * 3; }
            else { sl = cp * 0.995; tp = cp * 1.01; }

            return { signal: sig, confidence: Math.min(conf, 100), reasons: reas.length > 0 ? reas : ['An√°lisis en curso'], rsi, macd, bb, entry, stopLoss: sl, takeProfit: tp, atr, ma5: m5, ma10: m10 };
        };

        const calcRatios = (pair, analysis, profile) => {
            const { volatility = 50, pipValue = 10 } = pair;
            const { confidence } = analysis;
            const vf = Math.max(0.3, Math.min(1, 100 / volatility));
            const cf = confidence / 100;
            const bp = vf * cf * 0.8;
            const slp = Math.abs(analysis.entry - analysis.stopLoss) * (pair.decimals === 5 ? 100000 : pair.decimals === 3 ? 1000 : 100);
            return [
                { ratio: '1:1', pips: slp, probability: Math.min(Math.round(bp * 90), 95), expectedProfit: calculatePotentialProfit(profile.lotSize, slp, pipValue).toFixed(2) },
                { ratio: '1:1.5', pips: slp * 1.5, probability: Math.min(Math.round(bp * 75), 95), expectedProfit: calculatePotentialProfit(profile.lotSize, slp * 1.5, pipValue).toFixed(2) },
                { ratio: '1:2', pips: slp * 2, probability: Math.min(Math.round(bp * 60), 95), expectedProfit: calculatePotentialProfit(profile.lotSize, slp * 2, pipValue).toFixed(2) },
                { ratio: '1:2.5', pips: slp * 2.5, probability: Math.min(Math.round(bp * 50), 95), expectedProfit: calculatePotentialProfit(profile.lotSize, slp * 2.5, pipValue).toFixed(2) },
                { ratio: '1:3', pips: slp * 3, probability: Math.min(Math.round(bp * 40), 95), expectedProfit: calculatePotentialProfit(profile.lotSize, slp * 3, pipValue).toFixed(2) },
                { ratio: '1:4', pips: slp * 4, probability: Math.min(Math.round(bp * 30), 95), expectedProfit: calculatePotentialProfit(profile.lotSize, slp * 4, pipValue).toFixed(2) },
                { ratio: '1:5', pips: slp * 5, probability: Math.min(Math.round(bp * 20), 95), expectedProfit: calculatePotentialProfit(profile.lotSize, slp * 5, pipValue).toFixed(2) },
            ];
        };

        const XIcon = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;
        const BarChartIcon = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>;
        const TargetIcon = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>;
        const SettingsIcon = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="3"></circle><path d="M12 1v6m0 6v6m-9-9h6m6 0h6"></path></svg>;
        const BellIcon = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>;

        const ProfileModal = ({onClose, profile, onSave}) => {
            const [formData, setFormData] = useState(profile);
            const maxRisk = formData.accountSize * (formData.riskPerTrade / 100);
            const requiredMargin = calculateRequiredMargin(formData.lotSize, 1.1, formData.leverage);
            const freeMargin = formData.accountSize - requiredMargin;
            const marginLevel = (formData.accountSize / requiredMargin * 100);
            const handleSave = () => { onSave(formData); onClose(); };
            return (
                <div className="modal-overlay">
                    <div style={{minHeight:'100vh',padding:'2rem'}}>
                        <div style={{maxWidth:'900px',margin:'0 auto'}}>
                            <div className="card" style={{padding:'2rem'}}>
                                <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'2rem'}}>
                                    <h2 className="neon-text">CONFIGURACI√ìN DE CUENTA</h2>
                                    <button onClick={onClose} className="btn btn-small"><XIcon/></button>
                                </div>
                                <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fit, minmax(250px, 1fr))',gap:'1.5rem'}}>
                                    <div className="form-group">
                                        <label>üí∞ Tama√±o de Cuenta</label>
                                        <input type="number" value={formData.accountSize} onChange={(e)=>setFormData({...formData,accountSize:parseFloat(e.target.value)})}/>
                                    </div>
                                    <div className="form-group">
                                        <label>üí± Moneda de Cuenta</label>
                                        <select value={formData.currency} onChange={(e)=>setFormData({...formData,currency:e.target.value})}>
                                            <option value="USD">USD - D√≥lar</option>
                                            <option value="EUR">EUR - Euro</option>
                                            <option value="GBP">GBP - Libra</option>
                                        </select>
                                    </div>
                                    <div className="form-group">
                                        <label>üìä Apalancamiento</label>
                                        <select value={formData.leverage} onChange={(e)=>setFormData({...formData,leverage:parseInt(e.target.value)})}>
                                            <option value="30">30:1 (Conservador)</option>
                                            <option value="50">50:1 (Moderado)</option>
                                            <option value="100">100:1 (Est√°ndar)</option>
                                            <option value="200">200:1 (Agresivo)</option>
                                            <option value="500">500:1 (Muy Agresivo)</option>
                                        </select>
                                    </div>
                                    <div className="form-group">
                                        <label>‚ö†Ô∏è Riesgo por Operaci√≥n (%)</label>
                                        <input type="number" step="0.5" min="0.5" max="10" value={formData.riskPerTrade} onChange={(e)=>setFormData({...formData,riskPerTrade:parseFloat(e.target.value)})}/>
                                        <p style={{fontSize:'0.75rem',color:'var(--text-gray)',marginTop:'0.5rem'}}>M√°ximo a arriesgar: ${maxRisk.toFixed(2)}</p>
                                    </div>
                                    <div className="form-group">
                                        <label>üì¶ Tama√±o de Lote (Lots)</label>
                                        <input type="number" step="0.01" min="0.01" value={formData.lotSize} onChange={(e)=>setFormData({...formData,lotSize:parseFloat(e.target.value)})}/>
                                        <p style={{fontSize:'0.75rem',color:'var(--text-gray)',marginTop:'0.5rem'}}>0.01 = Micro | 0.1 = Mini | 1.0 = Est√°ndar</p>
                                    </div>
                                    <div className="form-group">
                                        <label>üéØ Score M√≠nimo</label>
                                        <input type="number" min="0" max="100" value={formData.minScore} onChange={(e)=>setFormData({...formData,minScore:parseInt(e.target.value)})}/>
                                        <p style={{fontSize:'0.75rem',color:'var(--text-gray)',marginTop:'0.5rem'}}>Solo mostrar oportunidades con score superior</p>
                                    </div>
                                </div>
                                <div className="stats-grid" style={{marginTop:'2rem'}}>
                                    <div className="stat-box"><div className="stat-value">${maxRisk.toFixed(2)}</div><div className="stat-label">Riesgo M√°ximo</div></div>
                                    <div className="stat-box"><div className="stat-value">${requiredMargin.toFixed(2)}</div><div className="stat-label">Margen Requerido</div></div>
                                    <div className="stat-box"><div className="stat-value">${freeMargin.toFixed(2)}</div><div className="stat-label">Margen Libre</div></div>
                                    <div className="stat-box"><div className="stat-value">{marginLevel.toFixed(0)}%</div><div className="stat-label">Nivel de Margen</div></div>
                                </div>
                                <button onClick={handleSave} className="btn btn-primary" style={{width:'100%',marginTop:'2rem'}}>üíæ GUARDAR CONFIGURACI√ìN</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const AlarmsModal = ({onClose, alarms, onSave, pairs}) => {
            const [alarmList, setAlarmList] = useState(alarms);
            const [newAlarm, setNewAlarm] = useState({pair:'EURUSD',type:'price',condition:'above',value:''});
            const addAlarm = () => {
                if (!newAlarm.value) return;
                setAlarmList([...alarmList, {...newAlarm,id:Date.now(),active:true,triggered:false}]);
                setNewAlarm({pair:'EURUSD',type:'price',condition:'above',value:''});
            };
            const deleteAlarm = (id) => setAlarmList(alarmList.filter(a=>a.id!==id));
            const toggleAlarm = (id) => setAlarmList(alarmList.map(a=>a.id===id?{...a,active:!a.active}:a));
            const handleSave = () => { onSave(alarmList); onClose(); };
            return (
                <div className="modal-overlay">
                    <div style={{minHeight:'100vh',padding:'2rem'}}>
                        <div style={{maxWidth:'900px',margin:'0 auto'}}>
                            <div className="card" style={{padding:'2rem'}}>
                                <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'2rem'}}>
                                    <h2 className="neon-text">CONFIGURAR ALARMAS</h2>
                                    <button onClick={onClose} className="btn btn-small"><XIcon/></button>
                                </div>
                                <div style={{background:'var(--dark-elevated)',padding:'1.5rem',marginBottom:'2rem',border:'1px solid var(--border-dark)'}}>
                                    <h3 style={{marginBottom:'1rem',fontSize:'1rem'}}>‚ûï NUEVA ALARMA</h3>
                                    <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fit,minmax(150px,1fr))',gap:'1rem',marginBottom:'1rem'}}>
                                        <div><label>Par</label><select value={newAlarm.pair} onChange={(e)=>setNewAlarm({...newAlarm,pair:e.target.value})}>{PAIRS.map(p=><option key={p.displaySymbol} value={p.displaySymbol}>{p.displaySymbol}</option>)}</select></div>
                                        <div><label>Tipo</label><select value={newAlarm.type} onChange={(e)=>setNewAlarm({...newAlarm,type:e.target.value})}><option value="price">Precio</option><option value="score">Score</option><option value="change">% Cambio</option></select></div>
                                        <div><label>Condici√≥n</label><select value={newAlarm.condition} onChange={(e)=>setNewAlarm({...newAlarm,condition:e.target.value})}><option value="above">Por encima</option><option value="below">Por debajo</option></select></div>
                                        <div><label>Valor</label><input type="number" step="any" value={newAlarm.value} onChange={(e)=>setNewAlarm({...newAlarm,value:e.target.value})}/></div>
                                    </div>
                                    <button onClick={addAlarm} className="btn btn-primary" style={{width:'100%'}}>‚ûï A√ëADIR ALARMA</button>
                                </div>
                                <div>
                                    <h3 style={{marginBottom:'1rem',fontSize:'1rem'}}>üîî ALARMAS ACTIVAS ({alarmList.length})</h3>
                                    {alarmList.length===0?(
                                        <div style={{textAlign:'center',padding:'2rem',color:'var(--text-gray)'}}>No hay alarmas configuradas</div>
                                    ):(
                                        alarmList.map(alarm=>(
                                            <div key={alarm.id} className={'alarm-item '+(alarm.active?'alarm-active ':'')+(alarm.triggered?'alarm-triggered':'')}>
                                                <div><strong style={{color:'var(--neon-cyan)'}}>{alarm.pair}</strong> <span style={{color:'var(--text-gray)'}}>{alarm.type==='price'?'Precio':alarm.type==='score'?'Score':'% Cambio'} {alarm.condition==='above'?'>':'<'} {alarm.value}</span>{alarm.triggered&&<span style={{color:'var(--neon-red)',marginLeft:'1rem'}}>‚ö†Ô∏è ACTIVADA</span>}</div>
                                                <div style={{display:'flex',gap:'0.5rem'}}>
                                                    <button onClick={()=>toggleAlarm(alarm.id)} className="btn btn-small">{alarm.active?'Desactivar':'Activar'}</button>
                                                    <button onClick={()=>deleteAlarm(alarm.id)} className="btn btn-small" style={{borderColor:'var(--neon-red)',color:'var(--neon-red)'}}>Eliminar</button>
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>
                                <button onClick={handleSave} className="btn btn-primary" style={{width:'100%',marginTop:'2rem'}}>üíæ GUARDAR ALARMAS</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const CandlestickChart = ({priceHistory, pair}) => {
            const chartRef = useRef(null);
            const chartInstance = useRef(null);
            useEffect(()=>{
                if(!chartRef.current||!priceHistory||priceHistory.length<10)return;
                const ctx=chartRef.current.getContext('2d');
                if(chartInstance.current)chartInstance.current.destroy();
                const candles=priceHistory.slice(-50).map((price,i)=>{
                    const vol=0.001;
                    const open=i===0?price:priceHistory[Math.max(0,priceHistory.length-50+i-1)];
                    const close=price;
                    const high=Math.max(open,close)*(1+Math.random()*vol);
                    const low=Math.min(open,close)*(1-Math.random()*vol);
                    return{x:i,o:open,h:high,l:low,c:close};
                });
                chartInstance.current=new Chart(ctx,{type:'candlestick',data:{datasets:[{label:pair.displaySymbol,data:candles,color:{up:'#00ff00',down:'#ff0040',unchanged:'#808080'},borderColor:{up:'#00ff00',down:'#ff0040',unchanged:'#808080'}}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{display:true,grid:{color:'#1a1a1a'},ticks:{color:'#808080'}},y:{display:true,grid:{color:'#1a1a1a'},ticks:{color:'#808080'}}}}});
                return()=>{if(chartInstance.current)chartInstance.current.destroy();};
            },[priceHistory]);
            if(!priceHistory||priceHistory.length<10)return<div style={{textAlign:'center',padding:'2rem',color:'var(--text-gray)'}}>Acumulando datos... ({priceHistory?.length||0}/10)</div>;
            return<div className="chart-container"><canvas ref={chartRef}></canvas></div>;
        };

        const AdvancedAnalysisPanel = ({pair,onClose,priceHistory,profile}) => {
            if(!pair)return null;
            const analysis=analyzeSignals(pair,priceHistory);
            const ratios=calcRatios(pair,analysis,profile);
            const signalClass=analysis.signal==='BUY'?'signal-buy':analysis.signal==='SELL'?'signal-sell':'signal-neutral';
            const stopLossPips=Math.abs(analysis.entry-analysis.stopLoss)*(pair.decimals===5?100000:pair.decimals===3?1000:100);
            const takeProfitPips=Math.abs(analysis.takeProfit-analysis.entry)*(pair.decimals===5?100000:pair.decimals===3?1000:100);
            const riskAmount=profile.accountSize*(profile.riskPerTrade/100);
            const potentialLoss=calculatePotentialProfit(profile.lotSize,stopLossPips,pair.pipValue);
            const potentialProfit=calculatePotentialProfit(profile.lotSize,takeProfitPips,pair.pipValue);
            const requiredMargin=calculateRequiredMargin(profile.lotSize,pair.price,profile.leverage);
            return (
                <div className="modal-overlay">
                    <div style={{minHeight:'100vh',padding:'2rem'}}>
                        <div style={{maxWidth:'1600px',margin:'0 auto'}}>
                            <div style={{background:'var(--dark-surface)',border:'2px solid var(--neon-red)',padding:'2rem'}}>
                                <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'2rem'}}>
                                    <div><h2 className="neon-text" style={{fontSize:'2.5rem',marginBottom:'0.5rem'}}>{pair.displaySymbol}</h2><p style={{color:'var(--text-gray)'}}>{pair.name} ‚Ä¢ üî¥ Live: {pair.price.toFixed(pair.decimals)}</p></div>
                                    <button onClick={onClose} className="btn btn-small"><XIcon/></button>
                                </div>
                                <div className="card" style={{marginBottom:'2rem',padding:'2rem',textAlign:'center'}}>
                                    <h3 style={{marginBottom:'1rem'}}>SE√ëAL DE TRADING</h3>
                                    <div className={'signal-badge '+signalClass} style={{fontSize:'2rem',padding:'1rem 2rem'}}>{analysis.signal==='BUY'?'üü¢ COMPRA':analysis.signal==='SELL'?'üî¥ VENTA':'‚ö™ ESPERAR'}</div>
                                    <div style={{marginTop:'1rem',fontSize:'1.25rem',fontWeight:'700'}}>Confianza: {analysis.confidence}%</div>
                                    <div className="probability-bar" style={{marginTop:'1rem'}}><div className="probability-fill" style={{width:analysis.confidence+'%'}}>{analysis.confidence}%</div></div>
                                    <div className="stats-grid" style={{marginTop:'2rem'}}>
                                        <div className="stat-box"><div className="stat-value" style={{color:'var(--neon-red)'}}>-${potentialLoss.toFixed(2)}</div><div className="stat-label">P√©rdida Potencial</div></div>
                                        <div className="stat-box"><div className="stat-value" style={{color:'var(--neon-green)'}}>+${potentialProfit.toFixed(2)}</div><div className="stat-label">Ganancia Potencial</div></div>
                                        <div className="stat-box"><div className="stat-value">${requiredMargin.toFixed(2)}</div><div className="stat-label">Margen Requerido</div></div>
                                        <div className="stat-box"><div className="stat-value">{(potentialLoss/riskAmount*100).toFixed(1)}%</div><div className="stat-label">% de Riesgo Usado</div></div>
                                    </div>
                                </div>
                                <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fit,minmax(400px,1fr))',gap:'2rem'}}>
                                    <div className="card"><h3 style={{marginBottom:'1rem',display:'flex',alignItems:'center',gap:'0.5rem'}}><BarChartIcon/>GR√ÅFICO TIEMPO REAL</h3><CandlestickChart priceHistory={priceHistory} pair={pair}/></div>
                                    <div className="card">
                                        <h3 style={{marginBottom:'1rem'}}>INDICADORES T√âCNICOS</h3>
                                        <div className={'indicator-box '+(analysis.rsi<30?'bullish':analysis.rsi>70?'bearish':'neutral')}>
                                            <div style={{display:'flex',justifyContent:'space-between',marginBottom:'0.5rem'}}><strong>RSI (14)</strong><span style={{fontFamily:'Orbitron',fontSize:'1.25rem'}}>{analysis.rsi.toFixed(2)}</span></div>
                                            <div style={{fontSize:'0.875rem',color:'var(--text-gray)'}}>{analysis.rsi<30?'Sobreventa':analysis.rsi>70?'Sobrecompra':'Neutral'}</div>
                                        </div>
                                        <div className={'indicator-box '+(analysis.macd.histogram>0?'bullish':'bearish')}>
                                            <div style={{display:'flex',justifyContent:'space-between',marginBottom:'0.5rem'}}><strong>MACD</strong><span style={{fontFamily:'Orbitron'}}>{analysis.macd.histogram>0?'‚Üë':'‚Üì'}</span></div>
                                            <div style={{fontSize:'0.875rem'}}>Histograma: {analysis.macd.histogram.toFixed(6)}</div>
                                        </div>
                                        <div className="indicator-box neutral"><div style={{marginBottom:'0.5rem'}}><strong>Bandas Bollinger</strong></div><div style={{fontSize:'0.875rem'}}><div>Superior: {analysis.bb.upper.toFixed(pair.decimals)}</div><div>Media: {analysis.bb.middle.toFixed(pair.decimals)}</div><div>Inferior: {analysis.bb.lower.toFixed(pair.decimals)}</div></div></div>
                                        <div style={{padding:'1rem',background:'var(--dark-elevated)',border:'1px solid var(--border-dark)'}}><strong>Razones:</strong>{analysis.reasons.map((r,i)=><div key={i} style={{fontSize:'0.875rem',color:'var(--neon-cyan)',marginTop:'0.25rem'}}>‚Ä¢ {r}</div>)}</div>
                                    </div>
                                    <div className="card">
                                        <h3 style={{marginBottom:'1rem',display:'flex',alignItems:'center',gap:'0.5rem'}}><TargetIcon/>NIVELES SUGERIDOS</h3>
                                        <div style={{background:'var(--dark-elevated)',padding:'1.5rem',marginBottom:'1rem',border:'1px solid var(--neon-cyan)'}}>
                                            <div style={{marginBottom:'1rem'}}><div style={{fontSize:'0.75rem',color:'var(--text-gray)'}}>ENTRADA</div><div style={{fontSize:'1.5rem',fontWeight:'900',fontFamily:'Orbitron',color:'var(--neon-cyan)'}}>{analysis.entry.toFixed(pair.decimals)}</div></div>
                                            <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'1rem'}}>
                                                <div><div style={{fontSize:'0.75rem',color:'var(--text-gray)'}}>STOP LOSS</div><div style={{fontSize:'1.25rem',fontWeight:'700',fontFamily:'Orbitron',color:'var(--neon-red)'}}>{analysis.stopLoss.toFixed(pair.decimals)}</div><div style={{fontSize:'0.65rem',color:'var(--text-gray)'}}>{stopLossPips.toFixed(1)} pips</div></div>
                                                <div><div style={{fontSize:'0.75rem',color:'var(--text-gray)'}}>TAKE PROFIT</div><div style={{fontSize:'1.25rem',fontWeight:'700',fontFamily:'Orbitron',color:'var(--neon-green)'}}>{analysis.takeProfit.toFixed(pair.decimals)}</div><div style={{fontSize:'0.65rem',color:'var(--text-gray)'}}>{takeProfitPips.toFixed(1)} pips</div></div>
                                            </div>
                                        </div>
                                        <div style={{background:'var(--dark-elevated)',padding:'1rem',fontSize:'0.875rem'}}>
                                            <div style={{display:'flex',justifyContent:'space-between',marginBottom:'0.5rem'}}><span>Risk/Reward:</span><strong style={{color:'var(--neon-green)'}}>1:{(takeProfitPips/stopLossPips).toFixed(2)}</strong></div>
                                            <div style={{display:'flex',justifyContent:'space-between'}}><span>Tama√±o Posici√≥n:</span><strong>{profile.lotSize} lots</strong></div>
                                        </div>
                                    </div>
                                    <div className="card" style={{gridColumn:'span 2'}}>
                                        <h3 style={{marginBottom:'1.5rem'}}>üìä PROBABILIDADES R:R (Con tu configuraci√≥n: {profile.lotSize} lots)</h3>
                                        <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fit,minmax(150px,1fr))',gap:'1rem'}}>
                                            {ratios.map((ratio,i)=>(
                                                <div key={i} className="ratio-card">
                                                    <div style={{fontSize:'1.5rem',fontWeight:'900',fontFamily:'Orbitron',color:'var(--neon-cyan)',marginBottom:'0.5rem'}}>{ratio.ratio}</div>
                                                    <div style={{fontSize:'0.75rem',color:'var(--text-gray)',marginBottom:'0.5rem'}}>{ratio.pips.toFixed(1)} pips</div>
                                                    <div className="probability-bar"><div className="probability-fill" style={{width:ratio.probability+'%',background:ratio.probability>70?'linear-gradient(90deg, var(--neon-green), var(--neon-cyan))':ratio.probability>50?'linear-gradient(90deg, var(--neon-cyan), var(--neon-yellow))':'linear-gradient(90deg, var(--neon-yellow), var(--neon-red))'}}>{ratio.probability}%</div></div>
                                                    <div style={{fontSize:'0.875rem',color:'var(--neon-green)',marginTop:'0.5rem',fontWeight:'700'}}>+${ratio.expectedProfit}</div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [pairs, setPairs] = useState(PAIRS.map(p => ({ ...p, price: null, dailyOpen: null, dailyHigh: null, dailyLow: null, volatility: 50 })));
            const [priceHistories, setPriceHistories] = useState({});
            const [selectedPair, setSelectedPair] = useState(null);
            const [connected, setConnected] = useState(false);
            const [tickCount, setTickCount] = useState(0);
            const [lastUpdate, setLastUpdate] = useState('--:--:--');
            const [loadingPhase, setLoadingPhase] = useState('Init...');
            const [showProfile, setShowProfile] = useState(false);
            const [showAlarms, setShowAlarms] = useState(false);
            const [profile, setProfile] = useState(loadProfile());
            const [alarms, setAlarms] = useState(loadAlarms());
            const wsRef = useRef(null);

            const handleSaveProfile = (newProfile) => { setProfile(newProfile); saveProfile(newProfile); };
            const handleSaveAlarms = (newAlarms) => { setAlarms(newAlarms); saveAlarms(newAlarms); };

            useEffect(() => {
                pairs.forEach(pair => {
                    if (!pair.price) return;
                    const score = calcScore(pair, priceHistories[pair.displaySymbol]);
                    const change = pair.dailyOpen ? ((pair.price - pair.dailyOpen) / pair.dailyOpen * 100) : 0;
                    alarms.forEach(alarm => {
                        if (!alarm.active || alarm.triggered) return;
                        if (alarm.pair !== pair.displaySymbol) return;
                        let shouldTrigger = false;
                        if (alarm.type === 'price') shouldTrigger = alarm.condition === 'above' ? pair.price >= parseFloat(alarm.value) : pair.price <= parseFloat(alarm.value);
                        else if (alarm.type === 'score') shouldTrigger = alarm.condition === 'above' ? score >= parseFloat(alarm.value) : score <= parseFloat(alarm.value);
                        else if (alarm.type === 'change') shouldTrigger = alarm.condition === 'above' ? change >= parseFloat(alarm.value) : change <= parseFloat(alarm.value);
                        if (shouldTrigger) {
                            setAlarms(prev => prev.map(a => a.id === alarm.id ? {...a, triggered: true} : a));
                            saveAlarms(alarms.map(a => a.id === alarm.id ? {...a, triggered: true} : a));
                            if (Notification.permission === 'granted') new Notification('üö® FOREX DATA PRO', {body: alarm.pair+': '+alarm.type+' '+(alarm.condition==='above'?'>':'<')+' '+alarm.value});
                        }
                    });
                });
            }, [pairs, alarms, priceHistories]);

            useEffect(() => { if ('Notification' in window && Notification.permission === 'default') Notification.requestPermission(); }, []);

            useEffect(() => {
                const loadDailyData = async () => {
                    setLoadingPhase('üìä Cargando...');
                    for (const pairConfig of PAIRS) {
                        const dailyData = await fetchDailyOpen(pairConfig.symbol);
                        if (dailyData) setPairs(prev => prev.map(p => p.symbol === pairConfig.symbol ? { ...p, dailyOpen: dailyData.open, dailyHigh: dailyData.high, dailyLow: dailyData.low, price: dailyData.close } : p));
                    }
                    setLoadingPhase('‚ö° Conectando...');
                };
                loadDailyData();
            }, []);

            useEffect(() => {
                const timer = setTimeout(() => {
                    const socket = new WebSocket(FINNHUB_WS+'?token='+FINNHUB_API_KEY);
                    wsRef.current = socket;
                    socket.addEventListener('open', () => {
                        setConnected(true); setLoadingPhase(null);
                        PAIRS.forEach(pair => socket.send(JSON.stringify({ type: 'subscribe', symbol: pair.finnhubSymbol })));
                    });
                    socket.addEventListener('message', (event) => {
                        const data = JSON.parse(event.data);
                        if (data.type === 'trade') {
                            data.data.forEach(trade => {
                                const pairConfig = PAIRS.find(p => p.finnhubSymbol === trade.s);
                                if (!pairConfig) return;
                                const price = trade.p;
                                const timestamp = new Date(trade.t).toLocaleTimeString('es-ES');
                                setPairs(prev => prev.map(p => {
                                    if (p.symbol === pairConfig.symbol) {
                                        const newHigh = p.dailyHigh ? Math.max(p.dailyHigh, price) : price;
                                        const newLow = p.dailyLow ? Math.min(p.dailyLow, price) : price;
                                        const currentHistory = priceHistories[p.displaySymbol] || [];
                                        const recentPrices = currentHistory.slice(-50);
                                        const volatility = recentPrices.length > 10 ? Math.round(((Math.max(...recentPrices) - Math.min(...recentPrices)) / price) * 10000) : 50;
                                        return { ...p, price, dailyHigh: newHigh, dailyLow: newLow, volatility };
                                    }
                                    return p;
                                }));
                                setPriceHistories(prev => {
                                    const history = [...(prev[pairConfig.displaySymbol] || []), price];
                                    if (history.length > 200) history.shift();
                                    return { ...prev, [pairConfig.displaySymbol]: history };
                                });
                                setTickCount(c => c + 1); setLastUpdate(timestamp);
                            });
                        }
                    });
                    socket.addEventListener('close', () => setConnected(false));
                }, 2000);
                return () => {
                    clearTimeout(timer);
                    if (wsRef.current) {
                        PAIRS.forEach(pair => wsRef.current.send(JSON.stringify({ type: 'unsubscribe', symbol: pair.finnhubSymbol })));
                        wsRef.current.close();
                    }
                };
            }, []);

            const bestPair = pairs.filter(p => p.price && p.dailyOpen).reduce((best, curr) => {
                const currScore = calcScore(curr, priceHistories[curr.displaySymbol]);
                const bestScore = calcScore(best, priceHistories[best.displaySymbol]);
                return currScore > bestScore ? curr : best;
            }, pairs[0] || {});

            return (
                <div>
                    <header style={{ background: 'var(--dark-surface)', borderBottom: '2px solid var(--neon-red)', padding: '1.5rem' }}>
                        <div style={{ maxWidth: '1600px', margin: '0 auto' }}>
                            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', flexWrap: 'wrap', gap: '1rem' }}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
                                    <h1 style={{ fontSize: '2rem', color: 'var(--neon-red)' }}>FOREX DATA PRO</h1>
                                    <span className="live-badge">HYBRID</span>
                                </div>
                                <div style={{ display: 'flex', gap: '1rem', alignItems: 'center', flexWrap: 'wrap' }}>
                                    <div style={{ fontSize: '0.875rem', color: 'var(--neon-cyan)', fontFamily: 'Orbitron' }}>
                                        üí∞ ${profile.accountSize.toLocaleString()} ‚Ä¢ {profile.leverage}:1 ‚Ä¢ {profile.lotSize} lots
                                    </div>
                                    <button onClick={() => setShowProfile(true)} className="btn btn-small" style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                        <SettingsIcon /> PERFIL
                                    </button>
                                    <button onClick={() => setShowAlarms(true)} className="btn btn-small" style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                        <BellIcon /> ALARMAS
                                    </button>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', background: 'var(--dark-elevated)', padding: '0.5rem 1rem', border: '1px solid var(--border-dark)' }}>
                                        <div className={'status-dot '+(connected ? 'connected' : 'disconnected')}></div>
                                        <span style={{ fontSize: '0.875rem', fontFamily: 'Orbitron' }}>
                                            {connected ? 'üî¥ '+tickCount : loadingPhase || '‚ö†Ô∏è'}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div style={{ fontSize: '0.875rem', color: 'var(--text-gray)', marginTop: '0.5rem' }}>
                                ‚ö° Twelve Data + Finnhub ‚Ä¢ {lastUpdate}
                            </div>
                        </div>
                    </header>
                    <main style={{ maxWidth: '1600px', margin: '0 auto', padding: '2rem 1.5rem' }}>
                        <div style={{ marginBottom: '2rem' }}>
                            <h2 style={{ fontSize: '2rem', marginBottom: '0.5rem' }}>‚ö° STREAMING H√çBRIDO</h2>
                            <p style={{ color: 'var(--text-gray)', fontSize: '0.875rem' }}>% desde apertura real ‚Ä¢ Score din√°mico ‚Ä¢ An√°lisis t√©cnico</p>
                        </div>
                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '1.5rem' }}>
                            {pairs.map(pair => {
                                const { displaySymbol, name, price, dailyOpen, dailyHigh, dailyLow, decimals } = pair;
                                if (!price || !dailyOpen) {
                                    return (
                                        <div key={pair.symbol} className="card">
                                            <div style={{ textAlign: 'center', padding: '3rem 1rem', color: 'var(--text-gray)' }}>
                                                <div style={{ fontSize: '2rem', marginBottom: '1rem' }}>‚è≥</div>
                                                <p>Cargando...</p>
                                            </div>
                                        </div>
                                    );
                                }
                                const change = ((price - dailyOpen) / dailyOpen * 100).toFixed(2);
                                const changeAbs = (price - dailyOpen).toFixed(decimals);
                                const changeColor = parseFloat(change) >= 0 ? 'var(--neon-green)' : 'var(--neon-red)';
                                const score = calcScore(pair, priceHistories[displaySymbol]);
                                if (score < profile.minScore) return null;
                                return (
                                    <div key={pair.symbol} className={'card '+(bestPair && displaySymbol === bestPair.displaySymbol ? 'best-opportunity' : '')}>
                                        <div style={{ position: 'absolute', top: '1rem', right: '1rem', background: 'var(--dark-elevated)', padding: '0.5rem 1rem', border: '1px solid var(--neon-red)', fontFamily: 'Orbitron', fontSize: '0.875rem', fontWeight: '700' }}>
                                            SCORE: {score}
                                        </div>
                                        <div style={{ marginTop: '1rem', marginBottom: '1rem' }}>
                                            <h3 className="neon-text" style={{ fontSize: '1.5rem', fontWeight: '900', marginBottom: '0.25rem' }}>{displaySymbol}</h3>
                                            <p style={{ fontSize: '0.75rem', color: 'var(--text-gray)' }}>{name}</p>
                                        </div>
                                        <div style={{ marginBottom: '1rem' }}>
                                            <p style={{ fontSize: '0.75rem', color: 'var(--text-gray)', marginBottom: '0.25rem' }}>üî¥ PRECIO EN VIVO</p>
                                            <div style={{ display: 'flex', alignItems: 'baseline', gap: '0.5rem', marginBottom: '0.5rem' }}>
                                                <p className="price-change" style={{ fontSize: '1.75rem', fontWeight: '700', fontFamily: 'Orbitron' }}>{price.toFixed(decimals)}</p>
                                            </div>
                                            <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', fontSize: '0.875rem', marginBottom: '0.5rem' }}>
                                                <div style={{ display: 'flex', alignItems: 'center', gap: '0.25rem', color: changeColor, fontWeight: '700' }}>
                                                    <span>{parseFloat(change) >= 0 ? '‚ñ≤' : '‚ñº'}</span><span>{changeAbs}</span>
                                                </div>
                                                <div style={{ padding: '0.25rem 0.75rem', background: changeColor, color: 'var(--dark-bg)', fontWeight: '900', fontSize: '0.75rem', fontFamily: 'Orbitron' }}>
                                                    {parseFloat(change) >= 0 ? '+' : ''}{change}%
                                                </div>
                                            </div>
                                            <div style={{ fontSize: '0.65rem', color: 'var(--text-gray)' }}>
                                                Apertura: {dailyOpen.toFixed(decimals)} ‚Ä¢ Alto: {dailyHigh ? dailyHigh.toFixed(decimals) : '--'} ‚Ä¢ Bajo: {dailyLow ? dailyLow.toFixed(decimals) : '--'}
                                            </div>
                                        </div>
                                        <button onClick={() => setSelectedPair(pair)} className="btn btn-primary" style={{ width: '100%' }}>üéØ AN√ÅLISIS COMPLETO</button>
                                    </div>
                                );
                            })}
                        </div>
                    </main>
                    {selectedPair && <AdvancedAnalysisPanel pair={selectedPair} onClose={() => setSelectedPair(null)} priceHistory={priceHistories[selectedPair.displaySymbol] || []} profile={profile} />}
                    {showProfile && <ProfileModal onClose={() => setShowProfile(false)} profile={profile} onSave={handleSaveProfile} />}
                    {showAlarms && <AlarmsModal onClose={() => setShowAlarms(false)} alarms={alarms} onSave={handleSaveAlarms} pairs={PAIRS} />}
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
