<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FOREXRISK PRO ‚Ä¢ LIVE STREAMING</title>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@0.2.1/dist/chartjs-chart-financial.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;600;700&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --neon-red: #ff0040;
            --neon-green: #00ff00;
            --neon-cyan: #00ffff;
            --neon-yellow: #ffff00;
            --dark-bg: #000000;
            --dark-surface: #0a0a0a;
            --dark-elevated: #121212;
            --border-dark: #1a1a1a;
            --text-white: #ffffff;
            --text-gray: #808080;
        }

        body {
            background: var(--dark-bg);
            color: var(--text-white);
            font-family: 'Rajdhani', sans-serif;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(0deg, rgba(255, 0, 64, 0.03), rgba(255, 0, 64, 0.03) 1px, transparent 1px, transparent 2px);
            pointer-events: none;
            z-index: 1000;
            animation: scan 8s linear infinite;
        }

        @keyframes scan {
            0% { transform: translateY(0); }
            100% { transform: translateY(10px); }
        }

        h1, h2, h3, h4 {
            font-family: 'Orbitron', sans-serif;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .card {
            background: var(--dark-surface);
            border: 1px solid var(--border-dark);
            padding: 1.5rem;
            position: relative;
            transition: all 0.3s;
            clip-path: polygon(0 0, calc(100% - 15px) 0, 100% 15px, 100% 100%, 0 100%);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 15px;
            height: 15px;
            background: var(--neon-red);
            clip-path: polygon(100% 0, 100% 100%, 0 0);
        }

        .card:hover {
            border-color: var(--neon-red);
            box-shadow: 0 0 20px rgba(255, 0, 64, 0.3);
        }

        .best-opportunity {
            border: 3px solid var(--neon-red);
            box-shadow: 0 0 30px rgba(255, 0, 64, 0.8);
            animation: neonPulse 2s infinite;
            margin-top: 2.5rem;
        }

        .best-opportunity::after {
            content: '‚ö° MEJOR OPORTUNIDAD';
            position: absolute;
            top: -1.75rem;
            left: 50%;
            transform: translateX(-50%);
            background: var(--neon-red);
            color: var(--dark-bg);
            padding: 0.5rem 1.5rem;
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            font-size: 0.8rem;
            letter-spacing: 2px;
            white-space: nowrap;
            z-index: 10;
        }

        @keyframes neonPulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 0, 64, 0.8); }
            50% { box-shadow: 0 0 40px rgba(255, 0, 64, 1); }
        }

        .btn {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            padding: 0.75rem 1.5rem;
            border: 2px solid var(--neon-red);
            background: transparent;
            color: var(--neon-red);
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.3s;
            clip-path: polygon(10px 0, 100% 0, calc(100% - 10px) 100%, 0 100%);
        }

        .btn:hover {
            background: var(--neon-red);
            color: var(--dark-bg);
            box-shadow: 0 0 20px rgba(255, 0, 64, 0.8);
        }

        .btn-primary {
            background: var(--neon-red);
            color: var(--dark-bg);
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
        }

        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(5px);
            z-index: 999;
            overflow-y: auto;
        }

        .neon-text {
            color: var(--neon-red);
            text-shadow: 0 0 10px rgba(255, 0, 64, 0.8);
        }

        .signal-badge {
            padding: 0.5rem 1rem;
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            font-size: 0.875rem;
            letter-spacing: 1px;
            display: inline-block;
            animation: pulse 2s infinite;
        }

        .signal-buy { background: var(--neon-green); color: var(--dark-bg); box-shadow: 0 0 20px rgba(0, 255, 0, 0.8); }
        .signal-sell { background: var(--neon-red); color: var(--dark-bg); box-shadow: 0 0 20px rgba(255, 0, 64, 0.8); }
        .signal-neutral { background: var(--text-gray); color: var(--dark-bg); }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 1.5rem 0;
            background: var(--dark-elevated);
            padding: 1rem;
            border: 1px solid var(--border-dark);
        }

        .indicator-box {
            background: var(--dark-elevated);
            border-left: 3px solid;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .indicator-box.bullish { border-left-color: var(--neon-green); }
        .indicator-box.bearish { border-left-color: var(--neon-red); }
        .indicator-box.neutral { border-left-color: var(--text-gray); }

        .probability-bar {
            height: 30px;
            background: var(--dark-elevated);
            border: 1px solid var(--border-dark);
            position: relative;
            overflow: hidden;
        }

        .probability-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--neon-green), var(--neon-cyan));
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            color: var(--dark-bg);
        }

        .ratio-card {
            background: var(--dark-elevated);
            border: 1px solid var(--border-dark);
            padding: 1rem;
            text-align: center;
            transition: all 0.3s;
        }

        .ratio-card:hover {
            border-color: var(--neon-cyan);
            transform: translateY(-5px);
        }

        .live-badge {
            background: var(--neon-green);
            color: var(--dark-bg);
            padding: 0.25rem 0.75rem;
            font-size: 0.7rem;
            font-weight: 900;
            letter-spacing: 1px;
            animation: pulse 2s infinite;
        }

        .price-change {
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            animation: priceFlash 0.3s;
        }

        @keyframes priceFlash {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); color: var(--neon-cyan); }
            100% { transform: scale(1); }
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: pulse 2s infinite;
            display: inline-block;
        }

        .status-dot.connected {
            background: var(--neon-green);
            box-shadow: 0 0 10px var(--neon-green);
        }

        .status-dot.disconnected {
            background: var(--neon-red);
            box-shadow: 0 0 10px var(--neon-red);
        }

        @media (max-width: 768px) {
            .best-opportunity { margin-top: 3rem; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ==================== CONFIGURACI√ìN ====================

        const FINNHUB_API_KEY = 'd5n740hr01qh5ppc15r0d5n740hr01qh5ppc15rg';
        const FINNHUB_WS = 'wss://ws.finnhub.io';

        const PAIRS = [
            { symbol: 'OANDA:EUR_USD', displaySymbol: 'EURUSD', name: 'Euro / US Dollar', decimals: 5 },
            { symbol: 'OANDA:GBP_USD', displaySymbol: 'GBPUSD', name: 'British Pound / US Dollar', decimals: 5 },
            { symbol: 'OANDA:USD_JPY', displaySymbol: 'USDJPY', name: 'US Dollar / Japanese Yen', decimals: 3 },
            { symbol: 'OANDA:EUR_JPY', displaySymbol: 'EURJPY', name: 'Euro / Japanese Yen', decimals: 3 },
            { symbol: 'OANDA:XAU_USD', displaySymbol: 'XAUUSD', name: 'Gold / US Dollar', decimals: 2 },
        ];

        // ==================== FUNCIONES T√âCNICAS ====================

        const calculateRSI = (prices, period = 14) => {
            if (prices.length < period + 1) return 50;
            let gains = 0, losses = 0;
            for (let i = prices.length - period; i < prices.length; i++) {
                const change = prices[i] - prices[i - 1];
                if (change > 0) gains += change;
                else losses += Math.abs(change);
            }
            const avgGain = gains / period;
            const avgLoss = losses / period;
            if (avgLoss === 0) return 100;
            const rs = avgGain / avgLoss;
            return 100 - (100 / (1 + rs));
        };

        const calculateEMA = (prices, period) => {
            if (prices.length === 0) return 0;
            const k = 2 / (period + 1);
            let ema = prices[0];
            for (let i = 1; i < prices.length; i++) {
                ema = prices[i] * k + ema * (1 - k);
            }
            return ema;
        };

        const calculateMACD = (prices) => {
            if (prices.length < 26) return { macd: 0, signal: 0, histogram: 0 };
            const ema12 = calculateEMA(prices, 12);
            const ema26 = calculateEMA(prices, 26);
            const macd = ema12 - ema26;
            const signal = macd * 0.9;
            return { macd, signal, histogram: macd - signal };
        };

        const calculateBollingerBands = (prices, period = 20, stdDev = 2) => {
            if (prices.length < period) return { upper: 0, middle: 0, lower: 0 };
            const slice = prices.slice(-period);
            const middle = slice.reduce((a, b) => a + b, 0) / period;
            const variance = slice.reduce((sum, price) => sum + Math.pow(price - middle, 2), 0) / period;
            const std = Math.sqrt(variance);
            return { upper: middle + (std * stdDev), middle, lower: middle - (std * stdDev) };
        };

        const calculateMA = (prices, period) => {
            if (prices.length < period) return prices[prices.length - 1] || 0;
            const slice = prices.slice(-period);
            return slice.reduce((a, b) => a + b, 0) / period;
        };

        const analyzeSignals = (pair, priceHistory) => {
            if (!priceHistory || priceHistory.length < 30) {
                return {
                    signal: 'NEUTRAL', confidence: 0,
                    reasons: ['Acumulando datos (necesita 30+ ticks)'],
                    entry: pair.price, stopLoss: pair.price * 0.995, takeProfit: pair.price * 1.01,
                    rsi: 50, macd: { macd: 0, signal: 0, histogram: 0 },
                    bb: { upper: 0, middle: 0, lower: 0 }
                };
            }

            const rsi = calculateRSI(priceHistory);
            const macd = calculateMACD(priceHistory);
            const bb = calculateBollingerBands(priceHistory);
            const currentPrice = pair.price;
            const ma50 = calculateMA(priceHistory, Math.min(50, priceHistory.length));
            const ma200 = calculateMA(priceHistory, Math.min(200, priceHistory.length));

            let signal = 'NEUTRAL', confidence = 0;
            const reasons = [];

            if (rsi < 30) { confidence += 30; reasons.push(`RSI sobreventa (${rsi.toFixed(1)})`); signal = 'BUY'; }
            else if (rsi > 70) { confidence += 30; reasons.push(`RSI sobrecompra (${rsi.toFixed(1)})`); signal = 'SELL'; }

            if (macd.histogram > 0 && macd.macd > macd.signal) {
                confidence += 25; reasons.push('MACD cruce alcista');
                if (signal === 'NEUTRAL') signal = 'BUY';
            } else if (macd.histogram < 0 && macd.macd < macd.signal) {
                confidence += 25; reasons.push('MACD cruce bajista');
                if (signal === 'NEUTRAL') signal = 'SELL';
            }

            if (currentPrice < bb.lower) {
                confidence += 20; reasons.push('Precio bajo Bollinger');
                if (signal === 'NEUTRAL') signal = 'BUY';
            } else if (currentPrice > bb.upper) {
                confidence += 20; reasons.push('Precio sobre Bollinger');
                if (signal === 'NEUTRAL') signal = 'SELL';
            }

            if (ma50 > ma200 && currentPrice > ma50) {
                confidence += 15; reasons.push('Tendencia alcista');
                if (signal === 'NEUTRAL') signal = 'BUY';
            } else if (ma50 < ma200 && currentPrice < ma50) {
                confidence += 15; reasons.push('Tendencia bajista');
                if (signal === 'NEUTRAL') signal = 'SELL';
            }

            const volatility = pair.volatility || 50;
            if (volatility > 30 && volatility < 100) { confidence += 10; reasons.push('Volatilidad √≥ptima'); }

            const atr = ((bb.upper - bb.lower) / 2) || (currentPrice * 0.002);
            let entry = currentPrice, stopLoss, takeProfit;

            if (signal === 'BUY') {
                stopLoss = currentPrice - (atr * 1.5);
                takeProfit = currentPrice + (atr * 3);
            } else if (signal === 'SELL') {
                stopLoss = currentPrice + (atr * 1.5);
                takeProfit = currentPrice - (atr * 3);
            } else {
                stopLoss = currentPrice * 0.995;
                takeProfit = currentPrice * 1.01;
            }

            return { signal, confidence: Math.min(confidence, 100), reasons, rsi, macd, bb, entry, stopLoss, takeProfit, atr, ma50, ma200 };
        };

        const calculateRatioProbabilities = (pair, analysis) => {
            const { volatility = 50 } = pair;
            const { confidence } = analysis;
            const volFactor = Math.max(0.3, Math.min(1, 100 / volatility));
            const confFactor = confidence / 100;
            const baseProbability = volFactor * confFactor * 0.8;

            return [
                { ratio: '1:1', pips: 50, probability: Math.min(Math.round(baseProbability * 90), 95), expectedProfit: '500.00' },
                { ratio: '1:1.5', pips: 75, probability: Math.min(Math.round(baseProbability * 75), 95), expectedProfit: '750.00' },
                { ratio: '1:2', pips: 100, probability: Math.min(Math.round(baseProbability * 60), 95), expectedProfit: '1000.00' },
                { ratio: '1:2.5', pips: 125, probability: Math.min(Math.round(baseProbability * 50), 95), expectedProfit: '1250.00' },
                { ratio: '1:3', pips: 150, probability: Math.min(Math.round(baseProbability * 40), 95), expectedProfit: '1500.00' },
                { ratio: '1:4', pips: 200, probability: Math.min(Math.round(baseProbability * 30), 95), expectedProfit: '2000.00' },
                { ratio: '1:5', pips: 250, probability: Math.min(Math.round(baseProbability * 20), 95), expectedProfit: '2500.00' },
            ];
        };

        // ==================== COMPONENTES ====================

        const XIcon = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;
        const BarChartIcon = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>;
        const TargetIcon = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>;

        const Header = ({ connected, tickCount, lastUpdate }) => (
            <header style={{ background: 'var(--dark-surface)', borderBottom: '2px solid var(--neon-red)', padding: '1.5rem' }}>
                <div style={{ maxWidth: '1600px', margin: '0 auto' }}>
                    <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', flexWrap: 'wrap', gap: '1rem' }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
                            <h1 style={{ fontSize: '2rem', color: 'var(--neon-red)' }}>FOREXRISK PRO</h1>
                            <span className="live-badge">LIVE STREAM</span>
                        </div>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', background: 'var(--dark-elevated)', padding: '0.5rem 1rem', border: '1px solid var(--border-dark)' }}>
                            <div className={`status-dot ${connected ? 'connected' : 'disconnected'}`}></div>
                            <span style={{ fontSize: '0.875rem', fontFamily: 'Orbitron' }}>
                                {connected ? `üî¥ EN VIVO ‚Ä¢ ${tickCount} ticks` : '‚ö†Ô∏è CONECTANDO...'}
                            </span>
                        </div>
                    </div>
                    <div style={{ fontSize: '0.875rem', color: 'var(--text-gray)', marginTop: '0.5rem' }}>
                        ‚ö° WebSocket Finnhub ‚Ä¢ Actualizaci√≥n autom√°tica en tiempo real ‚Ä¢ {lastUpdate}
                    </div>
                </div>
            </header>
        );

        const PairCard = ({ pair, onAnalyze, isBestOpportunity }) => {
            const { displaySymbol, name, price, open, decimals } = pair;

            if (!price) {
                return (
                    <div className="card">
                        <div style={{ textAlign: 'center', padding: '3rem 1rem', color: 'var(--text-gray)' }}>
                            <div style={{ fontSize: '2rem', marginBottom: '1rem' }}>‚è≥</div>
                            <p>Conectando stream...</p>
                        </div>
                    </div>
                );
            }

            const change = open ? ((price - open) / open * 100).toFixed(2) : '0.00';
            const changeColor = change >= 0 ? 'var(--neon-green)' : 'var(--neon-red)';
            const score = pair.score || 0;

            return (
                <div className={`card ${isBestOpportunity ? 'best-opportunity' : ''}`}>
                    <div style={{ position: 'absolute', top: '1rem', right: '1rem', background: 'var(--dark-elevated)', padding: '0.5rem 1rem', border: '1px solid var(--neon-red)', fontFamily: 'Orbitron', fontSize: '0.875rem', fontWeight: '700' }}>
                        SCORE: {score}
                    </div>

                    <div style={{ marginTop: '1rem', marginBottom: '1rem' }}>
                        <h3 className="neon-text" style={{ fontSize: '1.5rem', fontWeight: '900', marginBottom: '0.25rem' }}>
                            {displaySymbol}
                        </h3>
                        <p style={{ fontSize: '0.75rem', color: 'var(--text-gray)' }}>{name}</p>
                    </div>

                    <div style={{ marginBottom: '1rem' }}>
                        <p style={{ fontSize: '0.75rem', color: 'var(--text-gray)' }}>üî¥ PRECIO EN VIVO</p>
                        <div style={{ display: 'flex', alignItems: 'baseline', gap: '0.5rem' }}>
                            <p className="price-change" style={{ fontSize: '1.75rem', fontWeight: '700', fontFamily: 'Orbitron' }}>
                                {price.toFixed(decimals)}
                            </p>
                            <p style={{ fontSize: '1rem', fontWeight: '700', color: changeColor }}>
                                {change >= 0 ? '+' : ''}{change}%
                            </p>
                        </div>
                        <p style={{ fontSize: '0.65rem', color: 'var(--neon-cyan)', marginTop: '0.25rem' }}>
                            ‚ö° Auto-refresh ‚Ä¢ Streaming
                        </p>
                    </div>

                    <button onClick={() => onAnalyze(pair)} className="btn btn-primary" style={{ width: '100%' }}>
                        üéØ AN√ÅLISIS COMPLETO
                    </button>
                </div>
            );
        };

        const CandlestickChart = ({ priceHistory, pair }) => {
            const chartRef = useRef(null);
            const chartInstance = useRef(null);

            useEffect(() => {
                if (!chartRef.current || !priceHistory || priceHistory.length < 10) return;

                const ctx = chartRef.current.getContext('2d');
                if (chartInstance.current) chartInstance.current.destroy();

                const candles = priceHistory.slice(-50).map((price, i) => {
                    const volatility = 0.001;
                    const open = i === 0 ? price : priceHistory[Math.max(0, priceHistory.length - 50 + i - 1)];
                    const close = price;
                    const high = Math.max(open, close) * (1 + Math.random() * volatility);
                    const low = Math.min(open, close) * (1 - Math.random() * volatility);
                    return { x: i, o: open, h: high, l: low, c: close };
                });

                chartInstance.current = new Chart(ctx, {
                    type: 'candlestick',
                    data: {
                        datasets: [{
                            label: pair.displaySymbol,
                            data: candles,
                            color: { up: '#00ff00', down: '#ff0040', unchanged: '#808080' },
                            borderColor: { up: '#00ff00', down: '#ff0040', unchanged: '#808080' }
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            x: { display: true, grid: { color: '#1a1a1a' }, ticks: { color: '#808080' } },
                            y: { display: true, grid: { color: '#1a1a1a' }, ticks: { color: '#808080' } }
                        }
                    }
                });

                return () => { if (chartInstance.current) chartInstance.current.destroy(); };
            }, [priceHistory]);

            if (!priceHistory || priceHistory.length < 10) {
                return <div style={{ textAlign: 'center', padding: '2rem', color: 'var(--text-gray)' }}>Acumulando ticks para gr√°fico... ({priceHistory?.length || 0}/10)</div>;
            }

            return <div className="chart-container"><canvas ref={chartRef}></canvas></div>;
        };

        const AdvancedAnalysisPanel = ({ pair, onClose, priceHistory }) => {
            if (!pair) return null;

            const analysis = analyzeSignals(pair, priceHistory);
            const ratios = calculateRatioProbabilities(pair, analysis);
            const signalClass = analysis.signal === 'BUY' ? 'signal-buy' : analysis.signal === 'SELL' ? 'signal-sell' : 'signal-neutral';

            return (
                <div className="modal-overlay">
                    <div style={{ minHeight: '100vh', padding: '2rem' }}>
                        <div style={{ maxWidth: '1600px', margin: '0 auto' }}>
                            <div style={{ background: 'var(--dark-surface)', border: '2px solid var(--neon-red)', padding: '2rem' }}>
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem' }}>
                                    <div>
                                        <h2 className="neon-text" style={{ fontSize: '2.5rem', marginBottom: '0.5rem' }}>{pair.displaySymbol}</h2>
                                        <p style={{ color: 'var(--text-gray)' }}>{pair.name} ‚Ä¢ üî¥ Live: {pair.price.toFixed(pair.decimals)}</p>
                                    </div>
                                    <button onClick={onClose} className="btn btn-small"><XIcon /></button>
                                </div>

                                <div className="card" style={{ marginBottom: '2rem', padding: '2rem', textAlign: 'center' }}>
                                    <h3 style={{ marginBottom: '1rem' }}>SE√ëAL DE TRADING</h3>
                                    <div className={`signal-badge ${signalClass}`} style={{ fontSize: '2rem', padding: '1rem 2rem' }}>
                                        {analysis.signal === 'BUY' ? 'üü¢ COMPRA' : analysis.signal === 'SELL' ? 'üî¥ VENTA' : '‚ö™ ESPERAR'}
                                    </div>
                                    <div style={{ marginTop: '1rem', fontSize: '1.25rem', fontWeight: '700' }}>
                                        Confianza: {analysis.confidence}%
                                    </div>
                                    <div className="probability-bar" style={{ marginTop: '1rem' }}>
                                        <div className="probability-fill" style={{ width: `${analysis.confidence}%` }}>{analysis.confidence}%</div>
                                    </div>
                                </div>

                                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(400px, 1fr))', gap: '2rem' }}>
                                    <div className="card">
                                        <h3 style={{ marginBottom: '1rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                            <BarChartIcon /> GR√ÅFICO EN TIEMPO REAL
                                        </h3>
                                        <CandlestickChart priceHistory={priceHistory} pair={pair} />
                                    </div>

                                    <div className="card">
                                        <h3 style={{ marginBottom: '1rem' }}>INDICADORES T√âCNICOS</h3>

                                        <div className={`indicator-box ${analysis.rsi < 30 ? 'bullish' : analysis.rsi > 70 ? 'bearish' : 'neutral'}`}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem' }}>
                                                <strong>RSI (14)</strong>
                                                <span style={{ fontFamily: 'Orbitron', fontSize: '1.25rem' }}>{analysis.rsi.toFixed(2)}</span>
                                            </div>
                                            <div style={{ fontSize: '0.875rem', color: 'var(--text-gray)' }}>
                                                {analysis.rsi < 30 ? 'Sobreventa - Se√±al compra' : analysis.rsi > 70 ? 'Sobrecompra - Se√±al venta' : 'Zona neutral'}
                                            </div>
                                        </div>

                                        <div className={`indicator-box ${analysis.macd.histogram > 0 ? 'bullish' : 'bearish'}`}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem' }}>
                                                <strong>MACD</strong>
                                                <span style={{ fontFamily: 'Orbitron' }}>{analysis.macd.histogram > 0 ? '‚Üë' : '‚Üì'}</span>
                                            </div>
                                            <div style={{ fontSize: '0.875rem' }}>
                                                <div>Histograma: {analysis.macd.histogram.toFixed(6)}</div>
                                            </div>
                                        </div>

                                        <div className="indicator-box neutral">
                                            <div style={{ marginBottom: '0.5rem' }}><strong>Bandas Bollinger</strong></div>
                                            <div style={{ fontSize: '0.875rem' }}>
                                                <div>Superior: {analysis.bb.upper.toFixed(pair.decimals)}</div>
                                                <div>Media: {analysis.bb.middle.toFixed(pair.decimals)}</div>
                                                <div>Inferior: {analysis.bb.lower.toFixed(pair.decimals)}</div>
                                            </div>
                                        </div>

                                        <div style={{ padding: '1rem', background: 'var(--dark-elevated)', border: '1px solid var(--border-dark)' }}>
                                            <strong>Razones:</strong>
                                            {analysis.reasons.map((r, i) => (
                                                <div key={i} style={{ fontSize: '0.875rem', color: 'var(--neon-cyan)', marginTop: '0.25rem' }}>‚Ä¢ {r}</div>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="card">
                                        <h3 style={{ marginBottom: '1rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                            <TargetIcon /> NIVELES SUGERIDOS
                                        </h3>

                                        <div style={{ background: 'var(--dark-elevated)', padding: '1.5rem', marginBottom: '1rem', border: '1px solid var(--neon-cyan)' }}>
                                            <div style={{ marginBottom: '1rem' }}>
                                                <div style={{ fontSize: '0.75rem', color: 'var(--text-gray)' }}>ENTRADA</div>
                                                <div style={{ fontSize: '1.5rem', fontWeight: '900', fontFamily: 'Orbitron', color: 'var(--neon-cyan)' }}>
                                                    {analysis.entry.toFixed(pair.decimals)}
                                                </div>
                                            </div>

                                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem' }}>
                                                <div>
                                                    <div style={{ fontSize: '0.75rem', color: 'var(--text-gray)' }}>STOP LOSS</div>
                                                    <div style={{ fontSize: '1.25rem', fontWeight: '700', fontFamily: 'Orbitron', color: 'var(--neon-red)' }}>
                                                        {analysis.stopLoss.toFixed(pair.decimals)}
                                                    </div>
                                                </div>

                                                <div>
                                                    <div style={{ fontSize: '0.75rem', color: 'var(--text-gray)' }}>TAKE PROFIT</div>
                                                    <div style={{ fontSize: '1.25rem', fontWeight: '700', fontFamily: 'Orbitron', color: 'var(--neon-green)' }}>
                                                        {analysis.takeProfit.toFixed(pair.decimals)}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div style={{ background: 'var(--dark-elevated)', padding: '1rem', fontSize: '0.875rem' }}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                                                <span>Risk/Reward:</span>
                                                <strong style={{ color: 'var(--neon-green)' }}>
                                                    1:{(Math.abs(analysis.takeProfit - analysis.entry) / Math.abs(analysis.stopLoss - analysis.entry)).toFixed(2)}
                                                </strong>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="card" style={{ gridColumn: 'span 2' }}>
                                        <h3 style={{ marginBottom: '1.5rem' }}>üìä PROBABILIDADES POR RATIO R:R</h3>

                                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: '1rem' }}>
                                            {ratios.map((ratio, i) => (
                                                <div key={i} className="ratio-card">
                                                    <div style={{ fontSize: '1.5rem', fontWeight: '900', fontFamily: 'Orbitron', color: 'var(--neon-cyan)', marginBottom: '0.5rem' }}>
                                                        {ratio.ratio}
                                                    </div>
                                                    <div style={{ fontSize: '0.75rem', color: 'var(--text-gray)', marginBottom: '0.5rem' }}>
                                                        {ratio.pips} pips
                                                    </div>
                                                    <div className="probability-bar">
                                                        <div className="probability-fill" style={{ 
                                                            width: `${ratio.probability}%`,
                                                            background: ratio.probability > 70 ? 'linear-gradient(90deg, var(--neon-green), var(--neon-cyan))' : 
                                                                       ratio.probability > 50 ? 'linear-gradient(90deg, var(--neon-cyan), var(--neon-yellow))' : 
                                                                       'linear-gradient(90deg, var(--neon-yellow), var(--neon-red))'
                                                        }}>
                                                            {ratio.probability}%
                                                        </div>
                                                    </div>
                                                    <div style={{ fontSize: '0.75rem', color: 'var(--text-gray)', marginTop: '0.5rem' }}>
                                                        ~${ratio.expectedProfit}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>

                                        <div style={{ marginTop: '1.5rem', padding: '1rem', background: 'var(--dark-elevated)', border: '1px solid var(--border-dark)', fontSize: '0.875rem' }}>
                                            <strong>üí° Interpretaci√≥n:</strong>
                                            <div style={{ marginTop: '0.5rem', color: 'var(--text-gray)' }}>
                                                ‚Ä¢ <strong style={{ color: 'var(--neon-green)' }}>&gt;70%:</strong> Alta probabilidad<br/>
                                                ‚Ä¢ <strong style={{ color: 'var(--neon-cyan)' }}>50-70%:</strong> Probabilidad moderada<br/>
                                                ‚Ä¢ <strong style={{ color: 'var(--neon-red)' }}>&lt;50%:</strong> Baja probabilidad<br/>
                                                <br/>
                                                <em>Basado en: Confianza {analysis.confidence}% ‚Ä¢ Volatilidad del par ‚Ä¢ Datos en tiempo real</em>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // ==================== APP PRINCIPAL ====================

        const App = () => {
            const [pairs, setPairs] = useState(PAIRS.map(p => ({ ...p, price: null, open: null, volatility: 50, score: 0 })));
            const [priceHistories, setPriceHistories] = useState({});
            const [selectedPair, setSelectedPair] = useState(null);
            const [connected, setConnected] = useState(false);
            const [tickCount, setTickCount] = useState(0);
            const [lastUpdate, setLastUpdate] = useState('--:--:--');
            const wsRef = useRef(null);

            // ========== WEBSOCKET - SIN DELAYS - AUTO REFRESH ==========
            useEffect(() => {
                console.log('üöÄ Iniciando WebSocket - SIN delays - Auto-refresh activado');
                const socket = new WebSocket(`${FINNHUB_WS}?token=${FINNHUB_API_KEY}`);
                wsRef.current = socket;

                socket.addEventListener('open', () => {
                    console.log('‚úÖ WebSocket CONECTADO - Comenzando streaming autom√°tico');
                    setConnected(true);

                    // Suscripci√≥n INMEDIATA a todos los pares
                    PAIRS.forEach(pair => {
                        socket.send(JSON.stringify({ type: 'subscribe', symbol: pair.symbol }));
                        console.log('üì° Stream activado para:', pair.symbol);
                    });
                });

                // Auto-refresh: Procesar CADA mensaje que llega
                socket.addEventListener('message', (event) => {
                    const data = JSON.parse(event.data);

                    if (data.type === 'trade') {
                        data.data.forEach(trade => {
                            const pairConfig = PAIRS.find(p => p.symbol === trade.s);
                            if (!pairConfig) return;

                            const price = trade.p;
                            const timestamp = new Date(trade.t).toLocaleTimeString('es-ES');

                            // Actualizaci√≥n INMEDIATA de precios
                            setPairs(prev => prev.map(p => {
                                if (p.symbol === pairConfig.symbol) {
                                    const newOpen = p.open || price;

                                    // Calcular volatilidad en tiempo real
                                    const currentHistory = priceHistories[p.displaySymbol] || [];
                                    const recentPrices = currentHistory.slice(-50);
                                    const volatility = recentPrices.length > 10 
                                        ? Math.round(((Math.max(...recentPrices) - Math.min(...recentPrices)) / price) * 10000)
                                        : 50;

                                    // Score en tiempo real
                                    const allPrices = [...currentHistory, price];
                                    const ma50 = calculateMA(allPrices, Math.min(50, allPrices.length));
                                    const ma200 = calculateMA(allPrices, Math.min(200, allPrices.length));

                                    let score = 0;
                                    if ((price > ma200 && ma50 > ma200) || (price < ma200 && ma50 < ma200)) score += 40;
                                    score += Math.min(30, Math.abs(ma50 - ma200) / ma200 * 1000);
                                    score += volatility >= 40 && volatility <= 80 ? 20 : 10;
                                    if ((price > ma50 && ma50 > ma200) || (price < ma50 && ma50 < ma200)) score += 10;

                                    return { ...p, price, open: newOpen, volatility, score: Math.min(100, Math.round(score)) };
                                }
                                return p;
                            }));

                            // Actualizar historial AUTOM√ÅTICAMENTE
                            setPriceHistories(prev => {
                                const history = [...(prev[pairConfig.displaySymbol] || []), price];
                                if (history.length > 200) history.shift(); // Mantener √∫ltimos 200
                                return { ...prev, [pairConfig.displaySymbol]: history };
                            });

                            setTickCount(c => c + 1);
                            setLastUpdate(timestamp);
                        });
                    }
                });

                socket.addEventListener('close', () => {
                    console.log('‚ùå WebSocket desconectado');
                    setConnected(false);
                });

                socket.addEventListener('error', (error) => {
                    console.error('‚ö†Ô∏è Error WebSocket:', error);
                });

                // Cleanup al desmontar
                return () => {
                    console.log('üîå Cerrando WebSocket');
                    PAIRS.forEach(pair => {
                        socket.send(JSON.stringify({ type: 'unsubscribe', symbol: pair.symbol }));
                    });
                    socket.close();
                };
            }, []); // Solo se ejecuta UNA VEZ al montar - NO hay re-renders innecesarios

            const bestPair = pairs.filter(p => p.price).reduce((best, curr) => 
                curr.score > best.score ? curr : best
            , pairs[0] || {});

            return (
                <div>
                    <Header connected={connected} tickCount={tickCount} lastUpdate={lastUpdate} />

                    <main style={{ maxWidth: '1600px', margin: '0 auto', padding: '2rem 1.5rem' }}>
                        <div style={{ marginBottom: '2rem' }}>
                            <h2 style={{ fontSize: '2rem', marginBottom: '0.5rem' }}>‚ö° STREAMING EN TIEMPO REAL</h2>
                            <p style={{ color: 'var(--text-gray)', fontSize: '0.875rem' }}>
                                üî¥ Auto-refresh activado ‚Ä¢ Sin delays ‚Ä¢ WebSocket Finnhub ‚Ä¢ RSI, MACD, Bollinger en vivo
                            </p>
                        </div>

                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '1.5rem' }}>
                            {pairs.map(pair => (
                                <PairCard
                                    key={pair.symbol}
                                    pair={pair}
                                    onAnalyze={setSelectedPair}
                                    isBestOpportunity={bestPair && pair.displaySymbol === bestPair.displaySymbol && pair.price}
                                />
                            ))}
                        </div>
                    </main>

                    {selectedPair && (
                        <AdvancedAnalysisPanel 
                            pair={selectedPair} 
                            onClose={() => setSelectedPair(null)}
                            priceHistory={priceHistories[selectedPair.displaySymbol] || []}
                        />
                    )}
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>